# Marketbook 项目开发 SOP 流程

> 从计划到完成的一整套标准操作流程，便于团队协作与 AI 执行时保持一致。

---

## 一、流程总览

```
计划 → 拆分计划 → 实施 → 更新状态 → 记录 → 同步 → 归档
```

| 阶段 | 产出 | 位置 |
|------|------|------|
| 1. 计划 | 待做项、优先级、工作量 | `计划与进度.md` |
| 2. 拆分计划 | 可执行步骤、涉及文件 | `docs/plans/` |
| 3. 实施 | 代码/配置变更 | 项目各文件 |
| 4. 更新状态 | 步骤打勾、状态变更 | `计划与进度.md`、`docs/plans/*.md` |
| 5. 记录 | 实施过程、变更清单 | `docs/历史已使用内容/实施记录/` |
| 6. 同步 | Git 提交、推送、部署 | 见 `项目要素.md` 第六节 |
| 7. 归档 | 规划与记录归档 | `docs/历史已使用内容/` |

---

## 二、各阶段操作指南

### 1. 计划（在 计划与进度.md）

- **新增待做项**：按优先级（P0/P1/P2）写入对应区块
- **格式**：问题、方案、影响、工作量、涉及文件
- **引用**：若需详细拆分，写「实施拆分：见 `docs/plans/xxx.md`」

### 2. 拆分计划（在 docs/plans/）

- **新建文件**：`docs/plans/功能规划-{功能名}.md`
- **内容**：现状、目标、实施拆分表（步骤 | 内容 | 状态）、涉及文件、完成标准
- **状态**：每步为「待实施」→ 实施后改为「✅ 已完成」

### 3. 实施

- 按拆分计划逐步执行
- 每完成一步，更新 `docs/plans/*.md` 中对应步骤状态

### 4. 更新状态

- **计划与进度.md**：将「待做」改为「✅ 已完成」，或移到「历史进度摘要」
- **docs/plans/*.md**：所有步骤打勾后，可考虑归档

### 5. 记录（实施记录）

- **新建**：`docs/历史已使用内容/实施记录/YYYY-MM-DD-{功能简述}.md`
- **内容**：目标、已实施清单、文件变更表
- **示例**：参考 `2026-02-04-mobile-native-optimization.md`

### 6. 同步（Git + 部署）

按 `项目要素.md` 与 `docs/备份与同步.md` 执行：

1. **创建分支**：`git checkout -b backup-YYYYMMDD-描述`
2. **提交**：`git add -A` → `git commit -m "描述"`
3. **推送到 GitHub**：`git push -u origin backup-YYYYMMDD-描述`
4. **推送到服务器**（若需部署，按 `docs/备份与同步.md` 配置后执行）：
   ```bash
   # 使用环境变量：SERVER=user@host DEPLOY_PATH=/path/to/project
   cd 项目根目录
   tar --exclude='.git' --exclude='.env' --exclude='node_modules' -czf - . \
     | ssh $SERVER "cd $DEPLOY_PATH && tar -xzf -"
   ssh $SERVER "cd $DEPLOY_PATH && npm install && npm run build:api && npm run build:frontend"
   ```

### 7. 归档（完成后）

| 操作 | 说明 |
|------|------|
| 规划归档 | 将 `docs/plans/功能规划-xxx.md` 移至 `docs/历史已使用内容/功能规划/` |
| 更新 README | 在 `docs/历史已使用内容/README.md` 中补充新归档文件说明 |
| 计划与进度 | 从「待做」移除，在「历史进度摘要」中增加一行简述 |

---

## 三、目录结构速查

```
docs/
├── plans/                    # 待实施拆分计划
│   └── 功能规划-xxx.md
├── 历史已使用内容/
│   ├── 功能规划/             # 已完成的规划（从 plans 移入）
│   ├── 实施记录/             # 实施过程记录
│   └── 参考/                 # 外部参考文档
├── 项目开发SOP流程.md        # 本文件
└── 备份与同步.md             # 数据同步命令
```

---

## 四、检查清单（每次迭代后）

- [ ] `计划与进度.md` 状态已更新
- [ ] `docs/plans/*.md` 步骤状态已更新（若适用）
- [ ] 实施记录已写入 `docs/历史已使用内容/实施记录/`
- [ ] Git 已提交并推送到 GitHub
- [ ] **服务器已同步并重启**（若需部署）
- [ ] 完成后规划已移至 `docs/历史已使用内容/功能规划/`
- [ ] `docs/历史已使用内容/README.md` 已更新（若有新归档）

---

## 五、相关文档

| 文档 | 说明 |
|------|------|
| `项目要素.md` | 约束、发布与部署流程 |
| `计划与进度.md` | 历史进度与待做计划 |
| `docs/备份与同步.md` | 服务器数据同步命令 |
| `PROJECT_STRUCTURE.md` | 项目结构、路由、数据流 |
