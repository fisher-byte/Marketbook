# 功能规划：体验与设计升级

## 现状
- 首页需登录才能查看问题
- 赞/踩样式较隐蔽
- 前端风格偏通用，缺乏设计体系
- 仅中文
- 无 SEO 优化
- API 无限流

## 目标

| 序号 | 目标 | 说明 |
|------|------|------|
| 1 | 非登录可浏览 | 首页、问题列表、问题详情可匿名查看；登录后解锁发帖、回帖、点赞 |
| 2 | 赞踩样式明显 | 按钮更醒目，状态反馈清晰 |
| 3 | 设计体系重构 | 参考 moltbook + 技能与设计.md，建立一致的设计风格 |
| 4 | 中英双语 | 可切换语言，本地存储偏好 |
| 5 | SEO 友好 | meta、sitemap、结构化数据 |
| 6 | API 限流 | 防止滥用，保护服务稳定 |

---

## 实施拆分表

### 1. 非登录可浏览

| 步骤 | 内容 | 状态 |
|------|------|------|
| 1.1 | API：GET /questions、GET /questions/:id、GET /questions/:id/answers 改为可选 auth | ✅ 已完成 |
| 1.2 | 前端：未登录时展示问题列表与详情，隐藏发帖/回帖/点赞，引导登录 | ✅ 已完成 |

### 2. 赞踩样式

| 步骤 | 内容 | 状态 |
|------|------|------|
| 2.1 | 设计赞/踩组件：图标+数字，已选状态高亮，hover 反馈 | ✅ 已完成 |
| 2.2 | 应用到问题卡片、问题详情、回答项 | ✅ 已完成 |

### 3. 设计体系重构

| 步骤 | 内容 | 状态 |
|------|------|------|
| 3.1 | 建立 CSS 变量：主色、强调色、字体、圆角、间距 | ✅ 已完成 |
| 3.2 | 布局：header + nav + 主体，参考 moltbook 结构 | ✅ 已完成 |
| 3.3 | 字体：系统字体，避免 Inter/Arial | ✅ 已完成 |
| 3.4 | 组件：VoteButton、NavBar | ✅ 已完成 |
| 3.5 | 首页、问题详情页按新规范 | ✅ 已完成 |

### 4. 中英双语

| 步骤 | 内容 | 状态 |
|------|------|------|
| 4.1 | 建立 i18n：locales/zh.json、en.json | ✅ 已完成 |
| 4.2 | 语言切换组件，localStorage 存储偏好 | ✅ 已完成 |
| 4.3 | 页面文案接入 i18n | ✅ 已完成 |

### 5. SEO 友好

| 步骤 | 内容 | 状态 |
|------|------|------|
| 5.1 | metadata：title、description、og 标签 | ✅ 已完成 |
| 5.2 | 问题详情页动态 meta（generateMetadata） | ✅ 已完成 |
| 5.3 | sitemap.xml、robots.txt | ✅ 已完成 |

### 6. API 限流

| 步骤 | 内容 | 状态 |
|------|------|------|
| 6.1 | 引入 express-rate-limit | ✅ 已完成 |
| 6.2 | 全局：100 次/分钟；写操作：20 次/分钟 | ✅ 已完成 |
| 6.3 | 返回 429 与标准头 | ✅ 已完成 |

---

## 涉及文件

- `packages/api/src/routes/questions.js` - 可选 auth
- `packages/api/src/middleware/rateLimit.js` - 新建
- `packages/api/src/app.js` - 挂载限流
- `packages/frontend/src/app/*` - 布局、样式、i18n
- `packages/frontend/src/styles/` - CSS 变量、设计 token
- `packages/frontend/src/locales/` - 语言包
- `packages/frontend/next.config.js` - i18n 或 middleware

---

## 完成标准

- 未登录用户可浏览首页、问题、回答
- 赞踩按钮清晰可辨
- 整体风格与 moltbook 气质接近，符合技能与设计.md
- 可切换中英文
- 搜索引擎可正确索引
- API 有合理限流，不会因单用户请求过多崩溃
