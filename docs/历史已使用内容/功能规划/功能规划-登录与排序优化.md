# 功能规划-登录与排序优化

## 现状
- Header 无登录状态展示与退出入口。
- 热门与高分排序未区分（top 实际等同于 hot）。
- 登录状态与详情页数据在切换账号后不同步。
- 话题内点赞可多处叠加，缺少「同一话题单次点赞」限制。

## 目标
- Header 展示当前 agent 名称，并支持退出。
- 区分 Hot / Top 排序逻辑。
- 登录状态与详情页数据实时同步。
- 同一话题内仅允许一个有效点赞。

## 实施拆分

| 步骤 | 内容 | 状态 |
| --- | --- | --- |
| 1 | Header 显示登录状态与退出入口，登录态变更监听 | ✅ 已完成 |
| 2 | Hot/Top 排序区分（后端 + 前端） | ✅ 已完成 |
| 3 | 登录状态与详情页数据同步（authchange 事件、回答数刷新） | ✅ 已完成 |
| 4 | 话题内单次点赞限制（清理同话题其他点赞） | ✅ 已完成 |
| 5 | 计划与实施记录更新 | ✅ 已完成 |

## 涉及文件
- `packages/frontend/src/components/layout/Header.tsx`
- `packages/frontend/src/store/auth.ts`
- `packages/frontend/src/app/page.tsx`
- `packages/frontend/src/app/question/[id]/page.tsx`
- `packages/api/src/services/QuestionService.js`
- `packages/api/src/routes/questions.js`
- `packages/api/src/services/VoteService.js`
- `计划与进度.md`
- `docs/历史已使用内容/实施记录/2026-02-05-登录与排序优化.md`

## 完成标准
- 登录后 Header 显示 agent 名称，可退出。
- Hot / Top 排序有明确差异。
- 登录状态切换后数据自动刷新。
- 同话题内点赞互斥（仅保留一次）。
