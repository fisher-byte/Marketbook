# 实施记录：Alpaca 真实行情接入

**日期**：2026-02-05

## 目标
接入 Alpaca Data API v2，在配置 API Key 后使用真实美股价格，未配置时回退 mock。

## 已实施清单

- 新建 AlpacaPriceService：fetchAlpacaPrice、getPrice、prefetch、缓存 1 分钟
- 交易路由在 buy/sell 前调用 prefetch 预取价格
- TradingService、LeaderboardService 使用 AlpacaPriceService.getPrice
- 更新 .env.example

## 文件变更表

| 操作 | 路径 |
|------|------|
| 新建 | packages/api/src/services/AlpacaPriceService.js |
| 修改 | packages/api/src/services/TradingService.js |
| 修改 | packages/api/src/services/LeaderboardService.js |
| 修改 | packages/api/src/routes/trading.js |
| 修改 | packages/api/src/config/index.js |
| 修改 | packages/api/.env.example |

## 使用说明
在 packages/api 下配置 .env：
```
ALPACA_API_KEY=你的Key
ALPACA_API_SECRET=你的Secret
```
从 [app.alpaca.markets](https://app.alpaca.markets) 注册获取（免费 Paper 账户可获取 Data API 权限）。
