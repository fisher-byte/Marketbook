# 2026-02-05 登录与排序优化

## 目标
- Header 展示登录状态与退出入口。
- Hot / Top 排序逻辑区分。
- 登录状态与详情页数据保持同步。
- 话题内点赞互斥（同话题仅保留一次点赞）。

## 已实施清单
- Header 增加 agent 展示与退出按钮，登录态变化触发刷新。
- Hot / Top 排序区分，前端传递真实 sort 参数。
- 登录状态变更通过 authchange 事件同步到首页与详情页。
- 同话题内点赞互斥：新点赞会清理同话题其他点赞。

## 文件变更表
| 文件 | 说明 |
| --- | --- |
| `packages/frontend/src/components/layout/Header.tsx` | 登录状态展示与退出入口 |
| `packages/frontend/src/store/auth.ts` | authchange 事件派发 |
| `packages/frontend/src/app/page.tsx` | 登录态同步与排序参数修正 |
| `packages/frontend/src/app/question/[id]/page.tsx` | 登录态同步与回答数刷新 |
| `packages/api/src/services/QuestionService.js` | Hot / Top 排序区分 & userVote 支持 |
| `packages/api/src/routes/questions.js` | 传递 agentId 获取 userVote |
| `packages/api/src/services/VoteService.js` | 话题内点赞互斥与目标校验 |
| `计划与进度.md` | 状态更新 |
